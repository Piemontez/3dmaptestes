{"ast":null,"code":"import BoundingRectangle from \"../Core/BoundingRectangle.js\";\nimport Color from \"../Core/Color.js\";\nimport defined from \"../Core/defined.js\";\nimport destroyObject from \"../Core/destroyObject.js\";\nimport PixelFormat from \"../Core/PixelFormat.js\";\nimport ClearCommand from \"../Renderer/ClearCommand.js\";\nimport Framebuffer from \"../Renderer/Framebuffer.js\";\nimport PixelDatatype from \"../Renderer/PixelDatatype.js\";\nimport Renderbuffer from \"../Renderer/Renderbuffer.js\";\nimport RenderbufferFormat from \"../Renderer/RenderbufferFormat.js\";\nimport RenderState from \"../Renderer/RenderState.js\";\nimport Sampler from \"../Renderer/Sampler.js\";\nimport Texture from \"../Renderer/Texture.js\";\nimport PassThroughDepth from \"../Shaders/PostProcessStages/PassThroughDepth.js\";\n/**\n * @private\n */\n\nfunction GlobeTranslucencyFramebuffer() {\n  this._colorTexture = undefined;\n  this._depthStencilTexture = undefined;\n  this._depthStencilRenderbuffer = undefined;\n  this._framebuffer = undefined;\n  this._packedDepthTexture = undefined;\n  this._packedDepthFramebuffer = undefined;\n  this._renderState = undefined;\n  this._packedDepthCommand = undefined;\n  this._clearCommand = undefined;\n  this._viewport = new BoundingRectangle();\n  this._useScissorTest = false;\n  this._scissorRectangle = undefined;\n  this._useHdr = undefined;\n}\n\nObject.defineProperties(GlobeTranslucencyFramebuffer.prototype, {\n  classificationTexture: {\n    get: function () {\n      return this._colorTexture;\n    }\n  },\n  classificationFramebuffer: {\n    get: function () {\n      return this._framebuffer;\n    }\n  }\n});\n\nfunction destroyResources(globeTranslucency) {\n  globeTranslucency._colorTexture = globeTranslucency._colorTexture && !globeTranslucency._colorTexture.isDestroyed() && globeTranslucency._colorTexture.destroy();\n  globeTranslucency._depthStencilTexture = globeTranslucency._depthStencilTexture && !globeTranslucency._depthStencilTexture.isDestroyed() && globeTranslucency._depthStencilTexture.destroy();\n  globeTranslucency._depthStencilRenderbuffer = globeTranslucency._depthStencilRenderbuffer && !globeTranslucency._depthStencilRenderbuffer.isDestroyed() && globeTranslucency._depthStencilRenderbuffer.destroy();\n  globeTranslucency._framebuffer = globeTranslucency._framebuffer && !globeTranslucency._framebuffer.isDestroyed() && globeTranslucency._framebuffer.destroy();\n  globeTranslucency._packedDepthTexture = globeTranslucency._packedDepthTexture && !globeTranslucency._packedDepthTexture.isDestroyed() && globeTranslucency._packedDepthTexture.destroy();\n  globeTranslucency._packedDepthFramebuffer = globeTranslucency._packedDepthFramebuffer && !globeTranslucency._packedDepthFramebuffer.isDestroyed() && globeTranslucency._packedDepthFramebuffer.destroy();\n}\n\nfunction createResources(globeTranslucency, context, width, height, hdr) {\n  var pixelDatatype = hdr ? context.halfFloatingPointTexture ? PixelDatatype.HALF_FLOAT : PixelDatatype.FLOAT : PixelDatatype.UNSIGNED_BYTE;\n  globeTranslucency._colorTexture = new Texture({\n    context: context,\n    width: width,\n    height: height,\n    pixelFormat: PixelFormat.RGBA,\n    pixelDatatype: pixelDatatype,\n    sampler: Sampler.NEAREST\n  });\n\n  if (context.depthTexture) {\n    globeTranslucency._depthStencilTexture = new Texture({\n      context: context,\n      width: width,\n      height: height,\n      pixelFormat: PixelFormat.DEPTH_STENCIL,\n      pixelDatatype: PixelDatatype.UNSIGNED_INT_24_8\n    });\n  } else {\n    globeTranslucency._depthStencilRenderbuffer = new Renderbuffer({\n      context: context,\n      width: width,\n      height: height,\n      format: RenderbufferFormat.DEPTH_STENCIL\n    });\n  }\n\n  globeTranslucency._framebuffer = new Framebuffer({\n    context: context,\n    colorTextures: [globeTranslucency._colorTexture],\n    depthStencilTexture: globeTranslucency._depthStencilTexture,\n    depthStencilRenderbuffer: globeTranslucency._depthStencilRenderbuffer,\n    destroyAttachments: false\n  });\n  globeTranslucency._packedDepthTexture = new Texture({\n    context: context,\n    width: width,\n    height: height,\n    pixelFormat: PixelFormat.RGBA,\n    pixelDatatype: PixelDatatype.UNSIGNED_BYTE,\n    sampler: Sampler.NEAREST\n  });\n  globeTranslucency._packedDepthFramebuffer = new Framebuffer({\n    context: context,\n    colorTextures: [globeTranslucency._packedDepthTexture],\n    destroyAttachments: false\n  });\n}\n\nfunction updateResources(globeTranslucency, context, width, height, hdr) {\n  var colorTexture = globeTranslucency._colorTexture;\n  var textureChanged = !defined(colorTexture) || colorTexture.width !== width || colorTexture.height !== height || hdr !== globeTranslucency._useHdr;\n\n  if (textureChanged) {\n    destroyResources(globeTranslucency);\n    createResources(globeTranslucency, context, width, height, hdr);\n  }\n}\n\nfunction updateCommands(globeTranslucency, context, width, height, passState) {\n  globeTranslucency._viewport.width = width;\n  globeTranslucency._viewport.height = height;\n  var useScissorTest = !BoundingRectangle.equals(globeTranslucency._viewport, passState.viewport);\n  var updateScissor = useScissorTest !== globeTranslucency._useScissorTest;\n  globeTranslucency._useScissorTest = useScissorTest;\n\n  if (!BoundingRectangle.equals(globeTranslucency._scissorRectangle, passState.viewport)) {\n    globeTranslucency._scissorRectangle = BoundingRectangle.clone(passState.viewport, globeTranslucency._scissorRectangle);\n    updateScissor = true;\n  }\n\n  if (!defined(globeTranslucency._renderState) || !BoundingRectangle.equals(globeTranslucency._viewport, globeTranslucency._renderState.viewport) || updateScissor) {\n    globeTranslucency._renderState = RenderState.fromCache({\n      viewport: globeTranslucency._viewport,\n      scissorTest: {\n        enabled: globeTranslucency._useScissorTest,\n        rectangle: globeTranslucency._scissorRectangle\n      }\n    });\n  }\n\n  if (!defined(globeTranslucency._packedDepthCommand)) {\n    globeTranslucency._packedDepthCommand = context.createViewportQuadCommand(PassThroughDepth, {\n      uniformMap: {\n        u_depthTexture: function () {\n          return globeTranslucency._depthStencilTexture;\n        }\n      },\n      owner: globeTranslucency\n    });\n  }\n\n  if (!defined(globeTranslucency._clearCommand)) {\n    globeTranslucency._clearCommand = new ClearCommand({\n      color: new Color(0.0, 0.0, 0.0, 0.0),\n      depth: 1.0,\n      stencil: 0.0,\n      owner: globeTranslucency\n    });\n  }\n\n  globeTranslucency._packedDepthCommand.framebuffer = globeTranslucency._packedDepthFramebuffer;\n  globeTranslucency._packedDepthCommand.renderState = globeTranslucency._renderState;\n  globeTranslucency._clearCommand.framebuffer = globeTranslucency._framebuffer;\n  globeTranslucency._clearCommand.renderState = globeTranslucency._renderState;\n}\n\nGlobeTranslucencyFramebuffer.prototype.updateAndClear = function (hdr, viewport, context, passState) {\n  var width = viewport.width;\n  var height = viewport.height;\n  updateResources(this, context, width, height, hdr);\n  updateCommands(this, context, width, height, passState);\n  this._useHdr = hdr;\n};\n\nGlobeTranslucencyFramebuffer.prototype.clearClassification = function (context, passState) {\n  this._clearCommand.execute(context, passState);\n};\n\nGlobeTranslucencyFramebuffer.prototype.packDepth = function (context, passState) {\n  this._packedDepthCommand.execute(context, passState);\n\n  return this._packedDepthTexture;\n};\n\nGlobeTranslucencyFramebuffer.prototype.isDestroyed = function () {\n  return false;\n};\n\nGlobeTranslucencyFramebuffer.prototype.destroy = function () {\n  destroyResources(this);\n  return destroyObject(this);\n};\n\nexport default GlobeTranslucencyFramebuffer;","map":{"version":3,"sources":["/home/usuario/davi/thalamus/wms/3dmaptestes/leaflet_cesium/client/node_modules/cesium/Source/Scene/GlobeTranslucencyFramebuffer.js"],"names":["BoundingRectangle","Color","defined","destroyObject","PixelFormat","ClearCommand","Framebuffer","PixelDatatype","Renderbuffer","RenderbufferFormat","RenderState","Sampler","Texture","PassThroughDepth","GlobeTranslucencyFramebuffer","_colorTexture","undefined","_depthStencilTexture","_depthStencilRenderbuffer","_framebuffer","_packedDepthTexture","_packedDepthFramebuffer","_renderState","_packedDepthCommand","_clearCommand","_viewport","_useScissorTest","_scissorRectangle","_useHdr","Object","defineProperties","prototype","classificationTexture","get","classificationFramebuffer","destroyResources","globeTranslucency","isDestroyed","destroy","createResources","context","width","height","hdr","pixelDatatype","halfFloatingPointTexture","HALF_FLOAT","FLOAT","UNSIGNED_BYTE","pixelFormat","RGBA","sampler","NEAREST","depthTexture","DEPTH_STENCIL","UNSIGNED_INT_24_8","format","colorTextures","depthStencilTexture","depthStencilRenderbuffer","destroyAttachments","updateResources","colorTexture","textureChanged","updateCommands","passState","useScissorTest","equals","viewport","updateScissor","clone","fromCache","scissorTest","enabled","rectangle","createViewportQuadCommand","uniformMap","u_depthTexture","owner","color","depth","stencil","framebuffer","renderState","updateAndClear","clearClassification","execute","packDepth"],"mappings":"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","sourcesContent":["import BoundingRectangle from \"../Core/BoundingRectangle.js\";\nimport Color from \"../Core/Color.js\";\nimport defined from \"../Core/defined.js\";\nimport destroyObject from \"../Core/destroyObject.js\";\nimport PixelFormat from \"../Core/PixelFormat.js\";\nimport ClearCommand from \"../Renderer/ClearCommand.js\";\nimport Framebuffer from \"../Renderer/Framebuffer.js\";\nimport PixelDatatype from \"../Renderer/PixelDatatype.js\";\nimport Renderbuffer from \"../Renderer/Renderbuffer.js\";\nimport RenderbufferFormat from \"../Renderer/RenderbufferFormat.js\";\nimport RenderState from \"../Renderer/RenderState.js\";\nimport Sampler from \"../Renderer/Sampler.js\";\nimport Texture from \"../Renderer/Texture.js\";\nimport PassThroughDepth from \"../Shaders/PostProcessStages/PassThroughDepth.js\";\n\n/**\n * @private\n */\nfunction GlobeTranslucencyFramebuffer() {\n  this._colorTexture = undefined;\n  this._depthStencilTexture = undefined;\n  this._depthStencilRenderbuffer = undefined;\n  this._framebuffer = undefined;\n\n  this._packedDepthTexture = undefined;\n  this._packedDepthFramebuffer = undefined;\n\n  this._renderState = undefined;\n\n  this._packedDepthCommand = undefined;\n  this._clearCommand = undefined;\n\n  this._viewport = new BoundingRectangle();\n  this._useScissorTest = false;\n  this._scissorRectangle = undefined;\n  this._useHdr = undefined;\n}\n\nObject.defineProperties(GlobeTranslucencyFramebuffer.prototype, {\n  classificationTexture: {\n    get: function () {\n      return this._colorTexture;\n    },\n  },\n  classificationFramebuffer: {\n    get: function () {\n      return this._framebuffer;\n    },\n  },\n});\n\nfunction destroyResources(globeTranslucency) {\n  globeTranslucency._colorTexture =\n    globeTranslucency._colorTexture &&\n    !globeTranslucency._colorTexture.isDestroyed() &&\n    globeTranslucency._colorTexture.destroy();\n  globeTranslucency._depthStencilTexture =\n    globeTranslucency._depthStencilTexture &&\n    !globeTranslucency._depthStencilTexture.isDestroyed() &&\n    globeTranslucency._depthStencilTexture.destroy();\n  globeTranslucency._depthStencilRenderbuffer =\n    globeTranslucency._depthStencilRenderbuffer &&\n    !globeTranslucency._depthStencilRenderbuffer.isDestroyed() &&\n    globeTranslucency._depthStencilRenderbuffer.destroy();\n  globeTranslucency._framebuffer =\n    globeTranslucency._framebuffer &&\n    !globeTranslucency._framebuffer.isDestroyed() &&\n    globeTranslucency._framebuffer.destroy();\n  globeTranslucency._packedDepthTexture =\n    globeTranslucency._packedDepthTexture &&\n    !globeTranslucency._packedDepthTexture.isDestroyed() &&\n    globeTranslucency._packedDepthTexture.destroy();\n  globeTranslucency._packedDepthFramebuffer =\n    globeTranslucency._packedDepthFramebuffer &&\n    !globeTranslucency._packedDepthFramebuffer.isDestroyed() &&\n    globeTranslucency._packedDepthFramebuffer.destroy();\n}\n\nfunction createResources(globeTranslucency, context, width, height, hdr) {\n  var pixelDatatype = hdr\n    ? context.halfFloatingPointTexture\n      ? PixelDatatype.HALF_FLOAT\n      : PixelDatatype.FLOAT\n    : PixelDatatype.UNSIGNED_BYTE;\n  globeTranslucency._colorTexture = new Texture({\n    context: context,\n    width: width,\n    height: height,\n    pixelFormat: PixelFormat.RGBA,\n    pixelDatatype: pixelDatatype,\n    sampler: Sampler.NEAREST,\n  });\n\n  if (context.depthTexture) {\n    globeTranslucency._depthStencilTexture = new Texture({\n      context: context,\n      width: width,\n      height: height,\n      pixelFormat: PixelFormat.DEPTH_STENCIL,\n      pixelDatatype: PixelDatatype.UNSIGNED_INT_24_8,\n    });\n  } else {\n    globeTranslucency._depthStencilRenderbuffer = new Renderbuffer({\n      context: context,\n      width: width,\n      height: height,\n      format: RenderbufferFormat.DEPTH_STENCIL,\n    });\n  }\n\n  globeTranslucency._framebuffer = new Framebuffer({\n    context: context,\n    colorTextures: [globeTranslucency._colorTexture],\n    depthStencilTexture: globeTranslucency._depthStencilTexture,\n    depthStencilRenderbuffer: globeTranslucency._depthStencilRenderbuffer,\n    destroyAttachments: false,\n  });\n\n  globeTranslucency._packedDepthTexture = new Texture({\n    context: context,\n    width: width,\n    height: height,\n    pixelFormat: PixelFormat.RGBA,\n    pixelDatatype: PixelDatatype.UNSIGNED_BYTE,\n    sampler: Sampler.NEAREST,\n  });\n\n  globeTranslucency._packedDepthFramebuffer = new Framebuffer({\n    context: context,\n    colorTextures: [globeTranslucency._packedDepthTexture],\n    destroyAttachments: false,\n  });\n}\n\nfunction updateResources(globeTranslucency, context, width, height, hdr) {\n  var colorTexture = globeTranslucency._colorTexture;\n  var textureChanged =\n    !defined(colorTexture) ||\n    colorTexture.width !== width ||\n    colorTexture.height !== height ||\n    hdr !== globeTranslucency._useHdr;\n  if (textureChanged) {\n    destroyResources(globeTranslucency);\n    createResources(globeTranslucency, context, width, height, hdr);\n  }\n}\n\nfunction updateCommands(globeTranslucency, context, width, height, passState) {\n  globeTranslucency._viewport.width = width;\n  globeTranslucency._viewport.height = height;\n\n  var useScissorTest = !BoundingRectangle.equals(\n    globeTranslucency._viewport,\n    passState.viewport\n  );\n  var updateScissor = useScissorTest !== globeTranslucency._useScissorTest;\n  globeTranslucency._useScissorTest = useScissorTest;\n\n  if (\n    !BoundingRectangle.equals(\n      globeTranslucency._scissorRectangle,\n      passState.viewport\n    )\n  ) {\n    globeTranslucency._scissorRectangle = BoundingRectangle.clone(\n      passState.viewport,\n      globeTranslucency._scissorRectangle\n    );\n    updateScissor = true;\n  }\n\n  if (\n    !defined(globeTranslucency._renderState) ||\n    !BoundingRectangle.equals(\n      globeTranslucency._viewport,\n      globeTranslucency._renderState.viewport\n    ) ||\n    updateScissor\n  ) {\n    globeTranslucency._renderState = RenderState.fromCache({\n      viewport: globeTranslucency._viewport,\n      scissorTest: {\n        enabled: globeTranslucency._useScissorTest,\n        rectangle: globeTranslucency._scissorRectangle,\n      },\n    });\n  }\n\n  if (!defined(globeTranslucency._packedDepthCommand)) {\n    globeTranslucency._packedDepthCommand = context.createViewportQuadCommand(\n      PassThroughDepth,\n      {\n        uniformMap: {\n          u_depthTexture: function () {\n            return globeTranslucency._depthStencilTexture;\n          },\n        },\n        owner: globeTranslucency,\n      }\n    );\n  }\n\n  if (!defined(globeTranslucency._clearCommand)) {\n    globeTranslucency._clearCommand = new ClearCommand({\n      color: new Color(0.0, 0.0, 0.0, 0.0),\n      depth: 1.0,\n      stencil: 0.0,\n      owner: globeTranslucency,\n    });\n  }\n\n  globeTranslucency._packedDepthCommand.framebuffer =\n    globeTranslucency._packedDepthFramebuffer;\n  globeTranslucency._packedDepthCommand.renderState =\n    globeTranslucency._renderState;\n  globeTranslucency._clearCommand.framebuffer = globeTranslucency._framebuffer;\n  globeTranslucency._clearCommand.renderState = globeTranslucency._renderState;\n}\n\nGlobeTranslucencyFramebuffer.prototype.updateAndClear = function (\n  hdr,\n  viewport,\n  context,\n  passState\n) {\n  var width = viewport.width;\n  var height = viewport.height;\n\n  updateResources(this, context, width, height, hdr);\n  updateCommands(this, context, width, height, passState);\n\n  this._useHdr = hdr;\n};\n\nGlobeTranslucencyFramebuffer.prototype.clearClassification = function (\n  context,\n  passState\n) {\n  this._clearCommand.execute(context, passState);\n};\n\nGlobeTranslucencyFramebuffer.prototype.packDepth = function (\n  context,\n  passState\n) {\n  this._packedDepthCommand.execute(context, passState);\n  return this._packedDepthTexture;\n};\n\nGlobeTranslucencyFramebuffer.prototype.isDestroyed = function () {\n  return false;\n};\n\nGlobeTranslucencyFramebuffer.prototype.destroy = function () {\n  destroyResources(this);\n  return destroyObject(this);\n};\n\nexport default GlobeTranslucencyFramebuffer;\n"]},"metadata":{},"sourceType":"module"}